---
title: 'AWS Integration'
description: 'Learn how to integrate Gulp Planner with AWS services'
---

# AWS Integration

Gulp Planner provides native integration with various AWS services for both source and sink configurations. When running in AWS environments, authentication is handled automatically through IAM roles.

## Deployment Prerequisites

### Required AWS Permissions

<CodeGroup>
```json IAM Policy
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cloudformation:CreateStack",
                "cloudformation:UpdateStack",
                "cloudformation:DeleteStack",
                "cloudformation:DescribeStacks",
                "cloudformation:ListStacks",
                "cloudformation:GetTemplateSummary",
                "cloudformation:ValidateTemplate",
                "cloudformation:DescribeStackEvents",
                "cloudformation:DescribeStackResource",
                "cloudformation:DescribeStackResources"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "eks:CreateCluster",
                "eks:DeleteCluster",
                "eks:DescribeCluster",
                "eks:ListClusters",
                "eks:UpdateClusterVersion",
                "eks:UpdateClusterConfig",
                "eks:CreateNodegroup",
                "eks:DeleteNodegroup",
                "eks:DescribeNodegroup",
                "eks:ListNodegroups",
                "eks:UpdateNodegroupConfig",
                "eks:UpdateNodegroupVersion"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "ec2:CreateVpc",
                "ec2:DeleteVpc",
                "ec2:CreateSubnet",
                "ec2:DeleteSubnet",
                "ec2:CreateSecurityGroup",
                "ec2:DeleteSecurityGroup",
                "ec2:CreateRoute",
                "ec2:DeleteRoute",
                "ec2:CreateRouteTable",
                "ec2:DeleteRouteTable",
                "ec2:CreateInternetGateway",
                "ec2:DeleteInternetGateway",
                "ec2:CreateNatGateway",
                "ec2:DeleteNatGateway",
                "ec2:AllocateAddress",
                "ec2:ReleaseAddress",
                "ec2:DescribeVpcs",
                "ec2:DescribeSubnets",
                "ec2:DescribeSecurityGroups",
                "ec2:DescribeRouteTables",
                "ec2:DescribeInternetGateways",
                "ec2:DescribeNatGateways",
                "ec2:DescribeAddresses"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:CreateRole",
                "iam:DeleteRole",
                "iam:GetRole",
                "iam:PutRolePolicy",
                "iam:DeleteRolePolicy",
                "iam:CreateServiceLinkedRole",
                "iam:CreateOpenIDConnectProvider",
                "iam:DeleteOpenIDConnectProvider",
                "iam:GetOpenIDConnectProvider",
                "iam:TagOpenIDConnectProvider"
            ],
            "Resource": "*"
        }
    ]
}
```
</CodeGroup>

<Warning>
For production environments, it's recommended to scope these permissions more tightly by:
- Limiting to specific resource ARNs
- Using condition statements to restrict regions
- Implementing AWS Organizations SCPs
- Using permission boundaries
</Warning>

### Infrastructure Setup

Gulp Planner automatically sets up:

<AccordionGroup>
  <Accordion title="VPC with required networking">
    - Public and private subnets
    - NAT Gateways
    - Internet Gateway
    - VPC Endpoints for AWS services
  </Accordion>
  <Accordion title="EKS cluster">
    - Managed node groups
    - OIDC provider
    - Required security groups
  </Accordion>
  <Accordion title="IAM roles and service accounts">
    - EKS cluster role
    - Node group role
    - Service account roles
  </Accordion>
  <Accordion title="Flink Kubernetes Operator">
    - Cert Manager
    - Operator deployment
    - Custom resource definitions
  </Accordion>
</AccordionGroup>

The deployment will create service accounts with the necessary IAM roles using IRSA (IAM Roles for Service Accounts), so no explicit credentials are needed in your YAML configurations.

## Authentication

When running Gulp Planner jobs in AWS environments, authentication is handled through IAM roles that are automatically created and configured during deployment:

1. **EKS Service Account**: Created with appropriate IAM role and permissions
2. **IRSA**: Configured automatically for the Flink operator
3. **VPC Endpoints**: Created for AWS services (Kinesis, MSK, S3)

<Note>
No explicit credentials need to be specified in the YAML configuration when running in AWS - the Flink connectors will automatically use the IAM role credentials.
</Note>

## Amazon Kinesis

### Kinesis Source

<CodeGroup>
```yaml Source Configuration
sources:
  - id: "kinesis-input"
    type: "kinesis"
    config:
      region: "us-west-2"
      streamName: "my-stream"
      initialPosition: "LATEST"  # LATEST, TRIM_HORIZON, AT_TIMESTAMP
      # Optional configurations
      consumerName: "my-consumer"
      maxRecordsPerFetch: 10000
      fetchInterval: 200
      # Authentication handled by IAM role
    schema:
      timestamp: "java.lang.Long"
      data: "java.lang.String"
```
</CodeGroup>

### Kinesis Sink

<CodeGroup>
```yaml Sink Configuration
sinks:
  - id: "kinesis-output"
    type: "kinesis"
    input: "transform-1"
    config:
      region: "us-west-2"
      streamName: "output-stream"
      # Optional configurations
      batchSize: 500
      maxBatchSize: 1000
      flushInterval: 1000
      # Authentication handled by IAM role
```
</CodeGroup>

## Amazon MSK (Managed Streaming for Apache Kafka)

### MSK Source

<CodeGroup>
```yaml Source Configuration
sources:
  - id: "msk-input"
    type: "kafka"
    config:
      bootstrapServers: "${MSK_BOOTSTRAP_SERVERS}"
      topic: "input-topic"
      groupId: "consumer-group-1"
      securityProtocol: "SASL_SSL"
      saslMechanism: "AWS_MSK_IAM"
      # Authentication handled by IAM role
      # Optional configurations
      autoOffsetReset: "latest"
      isolationLevel: "read_committed"
    schema:
      timestamp: "java.lang.Long"
      message: "java.lang.String"
```
</CodeGroup>

### MSK Sink

<CodeGroup>
```yaml Sink Configuration
sinks:
  - id: "msk-output"
    type: "kafka"
    input: "transform-1"
    config:
      bootstrapServers: "${MSK_BOOTSTRAP_SERVERS}"
      topic: "output-topic"
      securityProtocol: "SASL_SSL"
      saslMechanism: "AWS_MSK_IAM"
      # Authentication handled by IAM role
      # Optional configurations
      acks: "all"
      retries: 3
      batchSize: 16384
```
</CodeGroup>

## Amazon S3

### S3 Source

<CodeGroup>
```yaml Source Configuration
sources:
  - id: "s3-input"
    type: "s3"
    config:
      region: "us-west-2"
      bucket: "my-bucket"
      prefix: "input/data/"
      # File format configuration
      format: "json"  # json, csv, parquet, avro
      # Optional configurations
      scanInterval: 60000  # Milliseconds between scans
      pathFilter: "*.json"
      # Authentication handled by IAM role
    schema:
      timestamp: "java.lang.Long"
      value: "java.lang.Double"
```
</CodeGroup>

### S3 Sink

<CodeGroup>
```yaml Sink Configuration
sinks:
  - id: "s3-output"
    type: "s3"
    input: "transform-1"
    config:
      region: "us-west-2"
      bucket: "my-bucket"
      prefix: "output/data/"
```
</CodeGroup> 