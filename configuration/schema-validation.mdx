---
title: "Schema Validation"
description: "Guide to schema validation and type safety in Gulp"
---

# Schema Validation

Gulp provides robust schema validation to ensure type safety and data consistency throughout your streaming pipeline.

## Basic Schema Definition

Define schemas for your data sources using JSON Schema format:

```yaml
sources:
  - id: "userEvents"
    type: "kafka"
    schema:
      type: "object"
      properties:
        userId:
          type: "string"
          description: "Unique user identifier"
        timestamp:
          type: "number"
          description: "Event timestamp in milliseconds"
        eventType:
          type: "string"
          enum: ["click", "view", "purchase"]
        value:
          type: "number"
          format: "double"
        metadata:
          type: "object"
          properties:
            browser:
              type: "string"
            version:
              type: "string"
      required: ["userId", "timestamp", "eventType"]
```

## Supported Types

### 1. Primitive Types

| Type | Description | Example |
|:-----|:------------|:--------|
| `string` | Text data | `"hello"` |
| `integer` | 32-bit integer | `42` |
| `long` | 64-bit integer | `1234567890` |
| `float` | 32-bit float | `3.14` |
| `double` | 64-bit float | `3.14159` |
| `boolean` | Boolean value | `true` |
| `binary` | Binary data | Base64 encoded |

### 2. Complex Types

#### Objects
```yaml
type: "object"
properties:
  name:
    type: "string"
  age:
    type: "integer"
  address:
    type: "object"
    properties:
      street:
        type: "string"
      city:
        type: "string"
required: ["name", "age"]
```

#### Arrays
```yaml
type: "array"
items:
  type: "string"
minItems: 1
maxItems: 10
uniqueItems: true
```

#### Maps
```yaml
type: "object"
additionalProperties:
  type: "string"
```

## Validation Rules

### 1. Type Constraints

```yaml
schema:
  type: "object"
  properties:
    age:
      type: "integer"
      minimum: 0
      maximum: 150
    score:
      type: "number"
      multipleOf: 0.5
    name:
      type: "string"
      minLength: 2
      maxLength: 100
      pattern: "^[A-Za-z ]+$"
```

### 2. Enum Constraints

```yaml
schema:
  type: "object"
  properties:
    status:
      type: "string"
      enum: ["active", "inactive", "pending"]
    priority:
      type: "integer"
      enum: [1, 2, 3, 4, 5]
```

### 3. Format Constraints

```yaml
schema:
  type: "object"
  properties:
    email:
      type: "string"
      format: "email"
    date:
      type: "string"
      format: "date-time"
    url:
      type: "string"
      format: "uri"
```

## Schema Evolution

Gulp supports schema evolution with compatibility checks:

```yaml
schemaConfig:
  evolution:
    mode: "backward"  # backward, forward, full
    validateNewSchema: true
    allowedChanges:
      - "addOptionalField"
      - "removeOptionalField"
      - "addEnumValue"
    blockedChanges:
      - "removeRequiredField"
      - "changeFieldType"
```

## Validation Behavior

Configure how validation errors are handled:

```yaml
validationConfig:
  onFailure: "error"  # error, warn, ignore
  errorOutput: "invalid-records"  # Side output for invalid records
  maxValidationErrors: 100  # Max errors before failing
  validationRules:
    - field: "timestamp"
      rule: "not-null"
      action: "error"
    - field: "value"
      rule: "range"
      min: 0
      max: 1000
      action: "warn"
```

## Performance Considerations

1. **Schema Complexity**:
   - Simple schemas validate faster
   - Avoid deep nesting when possible
   - Use appropriate types for better performance

2. **Validation Timing**:
   - Validation occurs at record ingestion
   - Consider sampling for high-throughput streams
   - Use side outputs for invalid records

3. **Memory Usage**:
   - Schema definitions are cached
   - Validation errors consume memory
   - Monitor validation error counts

## Monitoring

Key metrics to monitor:

1. Validation Metrics:
   - Invalid record count
   - Validation error types
   - Schema evolution events

2. Performance Metrics:
   - Validation latency
   - Memory usage
   - Error output rate

Configure alerts:

```yaml
monitoring:
  alerts:
    - name: "HighValidationErrors"
      metric: "validation.errors"
      threshold: 1000
      window: "5m"
      severity: "warning"
    - name: "SchemaEvolutionDetected"
      metric: "schema.evolution"
      threshold: 1
      window: "1h"
      severity: "info"
```

## Testing

Gulp provides utilities for testing schema validation:

```yaml
testConfig:
  validationTests:
    - name: "Test Valid Record"
      input:
        userId: "user123"
        timestamp: 1642438800000
        value: 42.0
      expectValid: true
    - name: "Test Invalid Type"
      input:
        userId: 123  # Should be string
        timestamp: "invalid"
        value: "not a number"
      expectValid: false
      expectedErrors:
        - field: "userId"
          message: "type mismatch"
        - field: "timestamp"
          message: "invalid number"
``` 