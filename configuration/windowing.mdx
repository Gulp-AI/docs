---
title: "Advanced Window Operations"
description: "Comprehensive guide to window operations and aggregations in Gulp"
---

# Window Operations

Gulp provides powerful window operation capabilities that allow you to process data streams in discrete time or count-based chunks. This guide covers all window types and their configurations.

## Window Types

### 1. Tumbling Windows

Tumbling windows group records into fixed-size, non-overlapping windows:

```yaml
transformations:
  - id: "hourlyStats"
    type: "window"
    input: "sourceStream"
    windowConfig:
      windowType: "tumbling"
      windowSize: 3600  # 1 hour in seconds
      timeUnit: "SECONDS"
      aggregateRules:
        - name: "totalValue"
          field: "value"
          operation: "sum"
          fieldType: "double"
```

### 2. Sliding Windows

Sliding windows allow overlap between windows:

```yaml
transformations:
  - id: "movingAverage"
    type: "window"
    input: "sourceStream"
    windowConfig:
      windowType: "sliding"
      windowSize: 300  # 5 minutes
      slideSize: 60    # Slide every minute
      timeUnit: "SECONDS"
      aggregateRules:
        - name: "avgValue"
          field: "value"
          operation: "avg"
          fieldType: "double"
```

### 3. Session Windows

Session windows group records based on activity periods:

```yaml
transformations:
  - id: "userSessions"
    type: "window"
    input: "sourceStream"
    windowConfig:
      windowType: "session"
      inactivityTimeout: 1800  # 30 minutes
      timeUnit: "SECONDS"
      maxElementsPerWindow: 10000  # Optional limit
      aggregateRules:
        - name: "sessionCount"
          field: "value"
          operation: "count"
          fieldType: "long"
```

## Advanced Features

### 1. Multiple Aggregations

You can perform multiple aggregations in a single window:

```yaml
windowConfig:
  windowType: "tumbling"
  windowSize: 3600
  timeUnit: "SECONDS"
  aggregateRules:
    - name: "totalValue"
      field: "value"
      operation: "sum"
      fieldType: "double"
    - name: "avgValue"
      field: "value"
      operation: "avg"
      fieldType: "double"
    - name: "uniqueUsers"
      field: "userId"
      operation: "distinct_count"
      fieldType: "long"
```

### 2. Key-Based Windows

Group windows by specific fields:

```yaml
transformations:
  - id: "userStats"
    type: "window"
    input: "sourceStream"
    keyBy:
      fields: ["userId", "category"]
    windowConfig:
      windowType: "tumbling"
      windowSize: 3600
      timeUnit: "SECONDS"
      aggregateRules:
        - name: "userTotal"
          field: "value"
          operation: "sum"
          fieldType: "double"
```

### 3. Late Event Handling

Configure how to handle late-arriving events:

```yaml
windowConfig:
  windowType: "tumbling"
  windowSize: 3600
  timeUnit: "SECONDS"
  allowedLateness: 300  # Allow events up to 5 minutes late
  lateEventOutput: "lateEvents"  # Optional side output for late events
  aggregateRules:
    - name: "totalValue"
      field: "value"
      operation: "sum"
      fieldType: "double"
```

## Supported Aggregations

| Operation | Description | Supported Types |
|:----------|:------------|:---------------|
| `sum` | Sum of values | numeric types |
| `avg` | Average of values | numeric types |
| `min` | Minimum value | numeric types |
| `max` | Maximum value | numeric types |
| `count` | Count of records | any type |
| `distinct_count` | Count of unique values | any type |
| `first` | First value in window | any type |
| `last` | Last value in window | any type |

## Performance Considerations

1. **Memory Usage**: 
   - Window state is kept in memory/state backend
   - Consider time vs count-based windows based on data rate
   - Monitor state size for large windows

2. **Parallelism**:
   - Windows can be processed in parallel when using `keyBy`
   - Choose keys that provide good distribution
   - Monitor key cardinality to avoid hotspots

3. **Watermark Strategy**:
   - Configure appropriate watermark interval
   - Balance latency vs completeness
   - Monitor late events ratio

## Error Handling

Handle window processing errors with:

```yaml
windowConfig:
  errorHandling:
    onLateEvent: "drop"  # or "side_output" or "include"
    onProcessingError: "skip"  # or "fail" or "retry"
    maxRetries: 3
    retryBackoff: 1000  # milliseconds
```

## Monitoring

Key metrics to monitor:

1. Window Processing:
   - Late events count
   - Processing time per window
   - Number of records per window

2. State:
   - Window state size
   - Checkpoint duration
   - Recovery time

3. Resources:
   - Memory usage
   - GC pressure
   - Network usage

Configure alerts for these metrics using the monitoring section in your job configuration. 